function parseCityJSON(){cityJSON=JSON.stringify(cities[targetCity]),currentCity=JSON.parse(cityJSON)}function init(){myMap=new ymaps.Map("ymwap__map",{center:[currentCity.cordinates.x,currentCity.cordinates.y],zoom:currentCity.zoom});for(var t=[],e=0;e<currentCity.markets.length;e++)t[e]=new ymaps.GeoObject({geometry:{type:"Point",coordinates:[currentCity.markets[e].posX,currentCity.markets[e].posY]},properties:{clusterCaption:currentCity.markets[e].hintContent,balloonContentHeader:currentCity.markets[e].marketName,balloonContentBody:currentCity.markets[e].marketText,balloonContentFooter:currentCity.markets[e].marketLink}});var a=new ymaps.Clusterer;a.add(t),myMap.geoObjects.add(a)}var myMap,myPlacemark,cityes=["Москва","Волгоград","Санкт-Петербург"],cityNumber=["0","1","2"],targetCity=0,moscow={idMap:1,cordinates:{x:"55.76",y:"37.64"},zoom:10,markets:[{posX:"55.79",posY:"37.64",marketName:"Самострой",marketText:"<p style='color: red'>тел. 8 800 000 00 00<br>тел. 8 800 000 00 00</p>",marketLink:"<a href='//ya.ru' target='_blank'>test</a>"},{posX:"55.76",posY:"37.64",marketName:"Метизы",marketText:"тел. 8 800 000 00 00",marketLink:""}]},volgograd={idMap:2,cordinates:{x:"48.72355642",y:"44.47880116"},zoom:10,markets:[{posX:"48.70439882",posY:"44.50945031",marketName:"Домовенок",marketText:"<p style='color: red'>тел. 8 800 000 00 00<br>тел. 8 800 000 00 00</p>",marketLink:"<a href='//ya.ru' target='_blank'>test</a>"},{posX:"48.71211158",posY:"44.52677651",marketName:"ДонСтрой",marketText:"тел. 8 800 000 00 00",marketLink:""}]},spb={idMap:3,cordinates:{x:"59.93329178",y:"30.36598448"},zoom:10,markets:[{posX:"59.93329178",posY:"30.36598448",marketName:"Домовенок 2",marketText:"<p style='color: red'>тел. 8 800 000 00 00<br>тел. 8 800 000 00 00</p>",marketLink:"<a href='//ya.ru' target='_blank'>test</a>"}]},cities=[moscow,volgograd,spb],cityJSON=JSON.stringify(cities[targetCity]),currentCity=JSON.parse(cityJSON),cityPoint;$(document).ready(function(){function t(){ymaps.geolocation.get({provider:"yandex"}).then(function(t){visitorLocationObject=t.geoObjects.get(0).properties.get("metaDataProperty"),cityPoint=visitorLocationObject.GeocoderMetaData.AddressDetails.Country.AddressLine,console.log(cityPoint);for(var e=0;e<cityes.length;e++){if(cityes[e]==cityPoint){targetCity=e,$(".ymwap__popup__title span").html(cityes[targetCity]),myMap.destroy();break}targetCity=0,$(".ymwap__popup__title span").html(cityes[targetCity])}})}ymaps.ready(t)}),$(document).ready(function(){var t=function(){$(".ymwap__map-question").hide(),$(".ymwap__map-title").addClass("init"),parseCityJSON(),init()};$(document).on("click","#ymwap__yes",function(e){e.preventDefault(),t()}),$(document).on("click","#ymwap__no",function(t){t.preventDefault(),$(".ymwap__popup-1").removeClass("visible"),$(".ymwap__popup-2").addClass("visible"),$(".ymwap__cities-list").html("");for(var e=0;e<cityes.length;e++)$(".ymwap__cities-list").append('<div class="ymwap__cities-list__item" data-number="'+cityNumber[e]+'">'+cityes[e]+"</div>")}),$(document).on("click",".ymwap__cities-list__item",function(t){t.preventDefault(),$(".ymwap__cities-list__item").removeClass("selected"),$(this).addClass("selected")}),$(document).on("click","#ymwap__choise-city",function(e){e.preventDefault(),$(".ymwap__cities-list__item").hasClass("selected")?(targetCity=$(".ymwap__cities-list__item.selected").data("number"),t()):alert("Выбири город!")})});