$(document).ready(function(){function e(){cityJSON=JSON.stringify(_[m]),r=JSON.parse(cityJSON)}function t(){o=new ymaps.Map("ymwap__map",{center:[r.cordinates.x,r.cordinates.y],zoom:r.zoom});for(var e=[],t=0;t<r.markets.length;t++)e[t]=new ymaps.GeoObject({geometry:{type:"Point",coordinates:[r.markets[t].posX,r.markets[t].posY]},properties:{clusterCaption:r.markets[t].hintContent,balloonContentHeader:r.markets[t].marketName,balloonContentBody:r.markets[t].marketText,balloonContentFooter:r.markets[t].marketLink}});var a=new ymaps.Clusterer;a.add(e),o.geoObjects.add(a)}function a(){var e;void 0!=$.cookie("geoData")?(e=$.cookie("geoData"),m=e,d()):ymaps.geolocation.get({provider:"yandex"}).then(function(e){visitorLocationObject=e.geoObjects.get(0).properties.get("metaDataProperty"),s=visitorLocationObject.GeocoderMetaData.AddressDetails.Country.AddressLine,console.log(s);for(var t=0;t<i.length;t++){if(i[t]==s){m=t,$(".ymwap__popup__title span").html(i[m]),o.destroy();break}m=0,$(".ymwap__popup__title span").html(i[m])}})}var o,r,s,i=["Москва","Волгоград","Санкт-Петербург"],n=["0","1","2"],m=0,p={idMap:1,cordinates:{x:"55.76",y:"37.64"},zoom:10,markets:[{posX:"55.79",posY:"37.64",marketName:"Самострой",marketText:"<p style='color: red'>тел. 8 800 000 00 00<br>тел. 8 800 000 00 00</p>",marketLink:"<a href='//ya.ru' target='_blank'>test</a>"},{posX:"55.76",posY:"37.64",marketName:"Метизы",marketText:"тел. 8 800 000 00 00",marketLink:""}]},c={idMap:2,cordinates:{x:"48.72355642",y:"44.47880116"},zoom:10,markets:[{posX:"48.70439882",posY:"44.50945031",marketName:"Домовенок",marketText:"<p style='color: red'>тел. 8 800 000 00 00<br>тел. 8 800 000 00 00</p>",marketLink:"<a href='//ya.ru' target='_blank'>test</a>"},{posX:"48.71211158",posY:"44.52677651",marketName:"ДонСтрой",marketText:"тел. 8 800 000 00 00",marketLink:""}]},l={idMap:3,cordinates:{x:"59.93329178",y:"30.36598448"},zoom:10,markets:[{posX:"59.93329178",posY:"30.36598448",marketName:"Домовенок 2",marketText:"<p style='color: red'>тел. 8 800 000 00 00<br>тел. 8 800 000 00 00</p>",marketLink:"<a href='//ya.ru' target='_blank'>test</a>"}]},_=[p,c,l];e(),ymaps.ready(a);var d=function(){$(".ymwap__map-question").hide(),$(".ymwap__map-title").addClass("init"),e(),t()};$(document).on("click","#ymwap__yes",function(e){e.preventDefault(),d(),$.cookie("geoData",m)}),$(document).on("click","#ymwap__no",function(e){e.preventDefault(),$(".ymwap__popup-1").removeClass("visible"),$(".ymwap__popup-2").addClass("visible"),$(".ymwap__cities-list").html("");for(var t=0;t<i.length;t++)$(".ymwap__cities-list").append('<div class="ymwap__cities-list__item" data-number="'+n[t]+'">'+i[t]+"</div>")}),$(document).on("click",".ymwap__cities-list__item",function(e){e.preventDefault(),$(".ymwap__cities-list__item").removeClass("selected"),$(this).addClass("selected")}),$(document).on("click","#ymwap__choise-city",function(e){e.preventDefault(),$(".ymwap__cities-list__item").hasClass("selected")?(m=$(".ymwap__cities-list__item.selected").data("number"),d(),$.cookie("geoData",m)):alert("Выбири город!")})});